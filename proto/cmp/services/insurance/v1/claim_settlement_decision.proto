syntax = "proto3";

package cmp.services.insurance.v1;

import "cmp/services/insurance/v1/claim_types.proto";
import "cmp/types/v1/common.proto";
import "cmp/types/v2/price.proto";
import "google/protobuf/timestamp.proto";

message InsuranceSettlementDecisionRequest {
  // Message header
  cmp.types.v1.RequestHeader header = 1;

  // Only respond with the products that are new, modified or deactivated after this
  // timestamp.
  //
  // Timestamps may be used for both off-chain and on-chain operations.
  // For on-chain operations, only seconds are supported, and nanoseconds
  // will be ignored.  
  google.protobuf.Timestamp modified_after = 2;

  // Claim IDs: Submission ID, Processing ID and Carrier ID
  cmp.services.insurance.v1.ClaimIds claim_ids = 3;

  // Claim Status
  cmp.services.insurance.v1.ClaimStatus status = 4;

  // TODO: Is this reference applied for Acceptance and Rejection ?
  string decision_reference = 5; 

  // More info about decision such as rejection reason.
  string decision_detail = 6;

  // Pay-out transaction
  cmp.services.insurance.v1.PayOutTransaction payout_transaction = 7;

  // TODO: ask whether there could be multiple payouts for the same claim.
  // Amount
  cmp.types.v2.PriceDetail amount = 8;
}

message InsuranceSettlementDecisionResponse { 
  // Message header
  cmp.types.v1.ResponseHeader header = 1;

  // Claim Message Response to respond with claim ids (processing, carrier and submission) and message status
  cmp.services.insurance.v1.ClaimMessageResponse claim_message_response = 2;
}

// Insurance settlement decision (Accepted or Rejected) service definition
//
// ![Diagram](https://storage.googleapis.com/docs-cmp-files/diagrams/proto/cmp/services/insurance/v1/claim_settlement_decision.proto.dot.xs.svg)
//
// [Open Message Diagram](https://storage.googleapis.com/docs-cmp-files/diagrams/proto/cmp/services/insurance/v1/claim_settlement_decision.proto.dot.svg)
service InsuranceSettlementDecisionService {
  // Returns insurance settlement response
  rpc InsuranceSettlementDecision(InsuranceSettlementDecisionRequest) returns (InsuranceSettlementDecisionResponse);
}